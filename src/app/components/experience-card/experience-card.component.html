<div class="experience-card" (click)="openCompanyDialog()">
    <div class="card-decoration"></div>
    <!-- Add watermark background -->
    <div class="card-watermark">
        <span nz-icon nzType="bank" nzTheme="outline"></span>
    </div>
    
    <div class="card-header">
        <div class="company-logo">
            <img [src]="'assets/images/companies/' + getCompanyLogo(experience.company)"
                 [alt]="experience.company + ' logo'"
                 onError="this.src='assets/images/companies/default-company.svg'"/>
        </div>
        <div class="position-company">
            <h3>{{ experience.position }}</h3>
            <div class="company">{{ experience.company }}</div>
        </div>
    </div>

    <div class="card-content">
        <p class="experience-description">{{ experience.description }}</p>
        
        <div class="meta-info">
            <div class="meta-item">
                <span nz-icon nzType="calendar" nzTheme="outline"></span>
                {{ experience.startDate }}
                - {{ experience.current ? ('COMMON.PRESENT' | translate) : experience.endDate }}
            </div>
            <div class="meta-item">
                <span nz-icon nzType="environment" nzTheme="outline"></span>
                {{ experience.location }}
            </div>
            <div class="meta-item">
                <span nz-icon nzType="team" nzTheme="outline"></span>
                {{ experience.type }}
            </div>
        </div>

        <div class="key-points">
            @if (experience.achievements && experience.achievements.length > 0) {
                <div class="achievements">
                    <div class="key-points-header">
                        <span nz-icon nzType="trophy" nzTheme="outline"></span>
                        <span>{{ 'SECTIONS.WORK_EXPERIENCE.NOTABLE_ACHIEVEMENTS' | translate }}</span>
                    </div>
                    <div class="key-points-text">
                        <p>
                            {{ experience.achievements[0] }}
                            <span class="more-indicator" *ngIf="experience.achievements && experience.achievements.length > 1">
                                +{{ experience.achievements.length - 1 }} {{ 'COMMON.MORE' | translate }}
                            </span>
                        </p>
                    </div>
                </div>
            }

            @if (experience.responsibilities.length) {
                <div class="responsibilities">
                    <div class="key-points-header">
                        <span nz-icon nzType="check-circle" nzTheme="outline"></span>
                        <span>{{ 'SECTIONS.WORK_EXPERIENCE.CORE_RESPONSIBILITIES' | translate }}</span>
                    </div>
                    <div class="key-points-text">
                        <p>
                            {{ experience.responsibilities[0] }}
                            <span class="more-indicator" *ngIf="experience.responsibilities.length > 1">
                                +{{ experience.responsibilities.length - 1 }} {{ 'COMMON.MORE' | translate }}
                            </span>
                        </p>
                    </div>
                </div>
            }
        </div>
    </div>
    
    <div class="card-footer">
        <button class="details-button">
            <span>{{ 'COMMON.VIEW_DETAILS' | translate }}</span>
            <span nz-icon nzType="right-circle" nzTheme="outline"></span>
        </button>
    </div>
</div>

<!-- Company Detail Dialog -->
<ng-template #companyDetailDialog>
    <div class="company-detail-dialog">
        <div class="dialog-background"></div>
        <app-watermark class="dialog-watermark" [customIcon]="'bank'"></app-watermark>
        
        <div class="dialog-header">
            <div class="header-content">
                <div class="company-logo">
                    <img [src]="'assets/images/companies/' + getCompanyLogo(experience.company)"
                         [alt]="experience.company + ' logo'"
                         onError="this.src='assets/images/companies/default-company.svg'"/>
                </div>
                <div class="company-info">
                    <h2>{{ experience.company }}</h2>
                    <h3 class="position">{{ experience.position }}</h3>
                </div>
            </div>
            
            <div class="meta-tags">
                <div class="meta-tag">
                    <span nz-icon nzType="calendar" nzTheme="outline"></span>
                    <span>{{ experience.startDate }} - {{ experience.current ? ('COMMON.PRESENT' | translate) : experience.endDate }}</span>
                </div>
                <div class="meta-tag">
                    <span nz-icon nzType="environment" nzTheme="outline"></span>
                    <span>{{ experience.location }}</span>
                </div>
                <div class="meta-tag">
                    <span nz-icon nzType="team" nzTheme="outline"></span>
                    <span>{{ experience.type }}</span>
                </div>
            </div>
        </div>

        <div class="dialog-content">
            <div class="scrollable-content">
                @if (experience.achievements && experience.achievements.length > 0) {
                    <div class="dialog-section">
                        <h3>
                            <span nz-icon nzType="trophy" nzTheme="outline"></span>
                            {{ 'SECTIONS.WORK_EXPERIENCE.NOTABLE_ACHIEVEMENTS' | translate }}
                        </h3>
                        <div class="content-paragraph">
                            @for (achievement of experience.achievements; track achievement) {
                                <p>{{ achievement }}</p>
                            }
                        </div>
                    </div>
                }

                @if (experience.responsibilities.length) {
                    <div class="dialog-section">
                        <h3>
                            <span nz-icon nzType="check-circle" nzTheme="outline"></span>
                            {{ 'SECTIONS.WORK_EXPERIENCE.CORE_RESPONSIBILITIES' | translate }}
                        </h3>
                        <div class="content-paragraph">
                            @for (responsibility of experience.responsibilities; track responsibility) {
                                <p>{{ responsibility }}</p>
                            }
                        </div>
                    </div>
                }

                <!-- Company Information Section - Description Only -->
                @if (experience.companyInfo) {
                    <div class="dialog-section company-details">
                        <h3>
                            <span nz-icon nzType="bank" nzTheme="outline"></span>
                            {{ 'SECTIONS.WORK_EXPERIENCE.ABOUT_COMPANY' | translate }}
                        </h3>
                        <div class="company-description">
                            {{ experience.companyInfo.description }}
                        </div>
                    </div>
                }
            </div>
            
            <!-- Fixed Company Contact Info at Bottom -->
            @if (experience.companyInfo) {
                <div class="company-contact-footer">
                    <div class="company-contact-info">
                        <div class="contact-item">
                            <span nz-icon nzType="environment" nzTheme="outline"></span>
                            {{ experience.companyInfo.address }}
                        </div>
                        <div class="contact-item">
                            <span nz-icon nzType="global" nzTheme="outline"></span>
                            <a [href]="experience.companyInfo.website"
                                target="_blank" rel="noopener noreferrer">{{ experience.companyInfo.website }}</a>
                        </div>
                        @if (experience.companyInfo.contact) {
                            <div class="contact-item">
                                <span nz-icon nzType="phone" nzTheme="outline"></span>
                                {{ experience.companyInfo.contact }}
                            </div>
                        }
                    </div>
                </div>
            }
        </div>
    </div>
</ng-template>
